<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <div id="content">
        <div id="input">
            <form action="submit">
                <label for="query">Query: </label>
                <input id="query" name="query" type="text">
                <input type="submit" value="Search">
            </form>
        </div>
        <div id="output"></div>
    </div>

    <script src="./api.js"></script>
    <script>
        // Temporary DOM
        const output = document.getElementById("output");
        const form = document.querySelector("form");
        const query = document.getElementById("query");
        let recipes = [];
        
        const updateRecipes = () => {
            output.innerHTML = '';
            recipes.forEach(r => {
                let div = document.createElement("div");
                let a = document.createElement("a");
                a.setAttribute("target", "_blank");
                a.className = "recipeLink";
                a.href = r.url;
                a.style.display = "flex";
                a.style.margin = "10px";
                a.style.alignItems = "center";
                a.style.border = "2px solid black";
                let image = document.createElement("img");
                image.setAttribute("src", r.image);
                image.style.height = "150px";
                image.style.padding = "10px";
                let label = document.createElement("a");
                label.innerHTML = r.label + ': ' + Math.floor(r.calories / r.yield) + ' calories / serving';
                label.style.fontSize = "30px";

                a.append(image, label);
                div.appendChild(a);
                output.appendChild(div);
            })
        }

        form.onsubmit = async e => {
            e.preventDefault();
            let calories = caloriesLocal();
            const caloriesPerDish = {
                breakfast: calories * 0.25,
                snack1: calories * 0.15,
                lunch: calories * 0.30,
                dinner: calories * 0.20,
                snack2: calories * 0.1
            }
            recipes = [];
            promises = [];
            for (const cal in caloriesPerDish) {
                let rand = Math.floor(Math.random() * 100);
                promises.push(RecipeAPI.fetchRecipes(query.value, {
                    from: rand, 
                    to: rand+1, 
                    calories: Math.floor(0.95 * caloriesPerDish[cal]) + '-' + Math.floor(1.05 * caloriesPerDish[cal])
                })
                .then((r) => {recipes.push(r[0]);})
                .catch(err => console.log(err)));
            }
            await Promise.all(promises);
            updateRecipes();
        }
        
        

    </script>
</body>
</html>